---
# tasks file for nfsutils
- name: Install nfs-utils Centos
  yum:
    name: nfs-utils
    state: present
  when: ansible_os_family == "RedHat"

- name: Iinstall packages DRBD
  ansible.builtin.apt:
    name:
      - nfs-common
    state: latest
  when: ansible_os_family == "Debian"

  
- name: Enable nfs
  service:
    name: nfs
    state: started
    enabled: yes
  when: ansible_os_family == "RedHat"  

- name: Enable nfs-common
  service:
    name: nfs-common
    state: started
    enabled: yes
  when: ansible_os_family == "Debian"  
  
    
- name: Create Exports NFS on NODE1
  shell: |
    cat <<EOF > /etc/exports
    /mnt/otus 10.0.0.30/24(rw,sync,root_squash)
    EOF
  when: (ansible_hostname == "drbdnode1")

- name: Enable nfs
  service:
    name: nfs
    state: restarted
    enabled: yes
  when: ansible_os_family == "RedHat"  
  
  
- name: Insert into fstab mount point on FRONT
  shell: |
    echo "10.0.0.30:/mnt/otus/ /var/www/html nfs vers=3,proto=udp,noauto,x-systemd.automount 0 0" >> /etc/fstab
  when: (ansible_hostname == "frontserver")

- name: Daemon reload
  shell: "systemctl daemon-reload"
  when: (ansible_hostname == "frontserver")

- name: Restart remotefs
  shell: "systemctl restart remote-fs.target"
  when: (ansible_hostname == "frontserver")

- name: Create a directory for shared
  file:
    path: /mnt/otus
    state: directory
    mode: '0777'
  when: (ansible_hostname == "frontserver")